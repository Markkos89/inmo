{% extends 'template.html' %}

{% block content %}

{% block styles %}
	<link rel="stylesheet" type="text/css" href="/css/index.css">
{% endblock %}

<div class="slider">
	{% for s in slider %}
	{% if loop.first %}
		<div class="slide current">
	{% else %}
		<div class="slide">
	{% endif %}
		</div>
	{% endfor %}
</div>
	
<div class="buttons">
	<button id="prev"><i class="fas fa-arrow-left"></i></button>
	<button id="next"><i class="fas fa-arrow-right"></i></button>
</div>

<div id="alquileresContainer">
	<div class="row orden">
		<div class="col m9 l9 offset-m3 offset-l3 s12 valign-wrapper" id="alquileresOrden">
			<div>
				<div class="input-field col s12" style="margin-bottom: 0;">
				    <select>
						<option value="" disabled selected>Elige una opcion</option>
						<option value="1">Menor precio</option>
						<option value="2">Mayor precio</option>
						<option value="3">Recien publicados</option>
				    </select>
	    			<label>Ordenar por</label>
  				</div>
			</div>
			<div>
				Mostrando {{ posts.length }} de {{ posts.length }} publicaciones
			</div>
		</div>
		<div class="col m3 l3 s12">
			<ul class="collapsible">
				<li class="active">
		      		<div class="collapsible-header"><i class="material-icons">filter_drama</i>Categorias</div>
		      		<div class="collapsible-body">
		      			<p>
							<label>
								<input type="checkbox" />
								<span class="negro">Alquiler (23)</span>
							</label>
						</p>
						<p>
							<label>
								<input type="checkbox" />
								<span class="negro">En venta (15)</span>
							</label>
						</p>
		      		</div>
	    		</li>
		    	<li>
		      		<div class="collapsible-header"><i class="material-icons">place</i>Ubicacion</div>
		      		<div class="collapsible-body">
		      			{% if cantByUbicacion.length %}
		      			{% for l in cantByUbicacion %}
		      			<p>
							<label>
								<input type="checkbox" />
								<span class="negro">{{ l.nombre }} ({{ l.suma }})</span>
							</label>
						</p>
						{% endfor %}
						{% else %}
							<p>No hay posts cargados</p>
						{% endif %}
		      		</div>
		    	</li>
	    		<li>
		      		<div class="collapsible-header"><i class="material-icons">whatshot</i>Tipo de propiedad</div>
		      		<div class="collapsible-body">
		      			<p>
							<label>
								<input type="checkbox">
								<span class="negro">Terrenos (43)</span>
							</label>
						</p>
						<p>
							<label>
								<input type="checkbox">
								<span class="negro">Casa (36)</span>
							</label>
						</p>
						<p>
							<label>
								<input type="checkbox">
								<span class="negro">Departamento (33)</span>
							</label>
						</p>
						<p>
							<label>
								<input type="checkbox">
								<span class="negro">Local comercial(5)</span>
							</label>
						</p>
						<p>
							<label>
								<input type="checkbox">
								<span class="negro">Campo (4)</span>
							</label>
						</p>
		      		</div>
		    	</li>
		  	</ul>
		</div>
		<div class="col m9 l9 s12" id="posts">
			{% if posts.length %}
			{% for p in posts %}
				<div class="row">
					<div class="card alquilerCard">
						<div class="card-content" style="padding: 0;">
							<div class="row" style="margin-bottom: 0; position: relative;">
								<div class="col m5 l5 s12 cardContent">
									<div class="card-image">	
										<div class="carousel carousel-slider center carouselCard" data-indicators="true">
											<div class="left izquierda">
												<a href="Previo" class="movePrevCarousel middle-indicator-text waves-effect waves-light content-indicator"><i class="material-icons left  middle-indicator-text">chevron_left</i></a>
											</div>
											<div class="right derecha">
												<a href="Siguiente" class=" moveNextCarousel middle-indicator-text waves-effect waves-light content-indicator"><i class="material-icons right middle-indicator-text">chevron_right</i></a>
											</div>
											{% for f in p.fotos %}
											<div class="carousel-item white-text center middle-indicator" href="#one!">
												<img class="responsive-img" src="/uploads/posts/{{ f.path }}" alt="" />
											</div>
											{% endfor %}
										</div>
										<a href="#modal1" class="modal-trigger btn-floating btn-large waves-effect waves-light red plusButton"><i class="material-icons">add</i></a>	
									</div>
								</div>
								<div class="col m7 s12 textos" style="padding: 10px;">
									<p class="tituloCard">{{ p.descripcion_corta }}</p>
									<p class="product-desc">12.000 m² cubiertos</p>
									<div class="price-container" style="margin-top: 4px;">
										<p class="price-offer" style="font-size: 16px;">{{ p.descripcion }}</p>
									</div>
								</div>
								<div style="position: absolute; bottom: 0; right: 20px; font-size: 14px;">Publicado el dia {{ p.fecha }}</div>
							</div>
						</div>
						<div class="card-action valign-wrapper">
							<div class="col m5 l5 s12">
								<span class="precioCard">${{ p.precio }}</span>
							</div>
							<div class="col m7 l7 s12 botonCard">
								<div><a href="#modal2" class="modal-trigger red waves-effect waves-light btn-small">Contactar</a></div>
							</div>
						</div>
					</div>
				</div>
			{% endfor %}
			{% else %}
				<div class="row">
					<h3>No hay post cargados</h3>
				</div>
			{% endif %}
		</div>
	</div>
</div>

<div id="modal1" class="modal bottom-sheet">
	<div class="modal-content">
		<div class="preloader-wrapper active">
			<div class="spinner-layer spinner-red-only">
				<div class="circle-clipper left">
					<div class="circle"></div>
				</div>
				<div class="gap-patch">
					<div class="circle"></div>
				</div>
				<div class="circle-clipper right">
					<div class="circle"></div>
				</div>
			</div>
		</div>
		<h4>Modal Header</h4>
		<p>A bunch of text</p>
	</div>
	<div class="modal-footer">
		<a href="#!" class="modal-close waves-effect waves-green btn-flat">Cerrar</a>
	</div>
</div>

<div id="modal2" class="modal bottom-sheet modal-fixed-footer">
	<div class="modal-content">
		<h4>Complete el formulario</h4>
		<div class="row">
    		<form class="col s12">
		      	<div class="row">
		        	<div class="input-field col m3 l3 s6">
		          		<input id="nombre" type="text" class="validate">
		          		<label for="nombre">Nombre</label>
	        		</div>
		        	<div class="input-field col m3 l3 s6">
		          		<input id="apellido" type="text" class="validate">
		          		<label for="apellido">Apellido</label>
	        		</div>
	        		<div class="input-field col m3 l3 s6">
		          		<input id="telefono" type="text" class="validate">
		          		<label for="telefono">Telefono</label>
	        		</div>
			        <div class="input-field col m3 l3 s6">
			            <input id="email" type="email" class="validate">
			            <label for="email">Email</label>
			        </div>
			        <div class="input-field col s12">
            			<textarea id="mensaje" class="materialize-textarea" data-length="120"></textarea>
            			<label for="mensaje">Mensaje</label>
          			</div>
		      	</div>
    		</form>
  		</div>
	</div>
	<div class="modal-footer">
		<a href="#!" class="modal-close waves-effect waves-green btn-flat">Cerrar</a>
		<a href="#!" class="waves-effect waves-green btn-flat red white-text" id="btnEnviar">Enviar</a>
	</div>
</div>

{% endblock %}

{% block scripts %}
<script type="text/javascript" src="/js/slider.js"></script>
<script type="text/javascript">
	$(function() {
		$(".sidenav").sidenav()

		$(window).scroll(function(){
			if($(window).scrollTop()>150){
				$('nav').addClass("backActive").removeClass("backInactive")
			}else{
				$('nav').addClass("backInactive").removeClass("backActive")
			}
		})

		// getPosts()
	})

	$('select').formSelect();
	$('.collapsible').collapsible();
	$('.modal').modal({
		dismissible: false,
		onOpenStart: function() {
			$("input, textarea").val("").removeClass('valid').removeClass('invalid')
		}
	});
	$('textarea#mensaje').characterCounter();

	$('.moveNextCarousel').click(function(e){
		e.preventDefault()
		e.stopPropagation()
		$(this).closest('.carousel').carousel('next')
	})

	$('.movePrevCarousel').click(function(e){
		e.preventDefault()
		e.stopPropagation()
		$(this).closest('.carousel').carousel('next')
	})

	$("#btnEnviar").click(() => {
		$('.toast').hide()
		let nombre = $("#nombre").val()
		let apellido = $("#apellido").val()
		let telefono = $("#telefono").val()
		let email = $("#email").val()
		let mensaje = $("#mensaje").val()

		if (nombre && apellido && telefono && email && mensaje) {
			$('.modal').modal('close')
			Swal.fire({
				type: "success",
				title: "Exito",
				text: "Mensaje enviado correctamente"
			})
		} else {
			let toastHTML = '<span>Debe completar todos los campos</span>'
	  		M.toast({html: toastHTML})			
		}
	})

	$("#btnIngresar").click(() => {
		$('.toast').hide()
		let usuario = $("#usuario").val()
		let contraseña = $("#contraseña").val()

		if (usuario && contraseña) {
			$('.modal').modal('close')
			$.post("/Inmobiliarias/Acceso", { usuario, contraseña })
			.then(data => {
				console.log(data)
				// Swal.fire({
				// 	type: "success",
				// 	title: "Exito",
				// 	text: "Bienvenido usuario"
				// })
				window.location = '/Inmobiliarias/Inicio'
			})
		} else {
			let toastHTML = '<span>Debe completar todos los campos</span>'
	  		M.toast({html: toastHTML})			
		}
	})

	// getPosts = () => {
	// 	$.ajax({
	//         method: "GET",
	//         url: "/posts",
	//         success: function(data) {
	//             let tablecontent = $($.parseHTML(data))
	//             $('#posts').html(tablecontent)
	//         }
	//     })	
	// }	

</script>
{% endblock %}